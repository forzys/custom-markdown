"use strict";var Markdown={};function identity(e){return e}function returnFalse(e){return false}function HookCollection(){}HookCollection.prototype={chain:function(e,r){var n=this[e];if(!n)throw new Error("unknown hook "+e);if(n===identity)this[e]=r;else this[e]=function(e){return r(n(e))}},set:function(e,r){if(!this[e])throw new Error("unknown hook "+e);this[e]=r},addNoop:function(e){this[e]=identity},addFalse:function(e){this[e]=returnFalse}};Markdown.HookCollection=HookCollection;function SaveHash(){}SaveHash.prototype={set:function(e,r){this["s_"+e]=r},get:function(e){return this["s_"+e]}};Markdown.Converter=function(){var n=this.hooks=new HookCollection;n.addNoop("plainLinkText");n.addNoop("preConversion");n.addNoop("postConversion");var v;var h;var u;var a;this.makeHtml=function(e){if(v)throw new Error("Recursive call to converter.makeHtml");v=new SaveHash;h=new SaveHash;u=[];a=0;e=n.preConversion(e);e=T(e);e=N(e);e=e.replace(/~/g,"~T");e=e.replace(/\$/g,"~D");e=e.replace(/\r\n/g,"\n");e=e.replace(/\r/g,"\n");e="\n\n"+e+"\n\n";e=A(e);e=M(e);e=e.replace(/^[ \t]+$/gm,"");e=t(e);e=r(e);e=i(e);e=K(e);e=e.replace(/~D/g,"$$");e=e.replace(/~T/g,"~");e=n.postConversion(e);u=h=v=null;return e};function r(e){e=e.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(e,r,n,t,a,c){r=r.toLowerCase();v.set(r,x(n));if(a){return t}else if(c){h.set(r,c.replace(/"/g,"&quot;"))}return""});return e}function t(e){e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,c);e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,c);e=e.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,c);e=e.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,c);e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,c);return e}function c(e,r){var n=r;n=n.replace(/^\n+/,"");n=n.replace(/\n+$/g,"");n="\n\n~K"+(u.push(n)-1)+"K\n\n";return n}function i(e,r){e=d(e);var n="<hr />\n";e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,n);e=e.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,n);e=e.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,n);e=m(e);e=_(e);e=H(e);e=t(e);e=y(e,r);return e}function p(e){e=C(e);e=o(e);e=E(e);e=g(e);e=l(e);e=q(e);e=e.replace(/~P/g,"://");e=x(e);e=b(e);e=e.replace(/  +\n/g," <br />\n");return e}function o(e){var r=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;e=e.replace(r,function(e){var r=e.replace(/(.)<\/?code>(?=.)/g,"$1`");r=D(r,e.charAt(1)=="!"?"\\`*_/":"\\`*_");return r});return e}function l(e){e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,f);e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,f);e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,f);return e}function f(e,r,n,t,a,c,o,l){if(l==undefined)l="";var i=r;var u=n.replace(/:\/\//g,"~P");var p=t.toLowerCase();var f=a;var g=l;if(f==""){if(p==""){p=u.toLowerCase().replace(/ ?\n/g," ")}f="#"+p;if(v.get(p)!=undefined){f=v.get(p);if(h.get(p)!=undefined){g=h.get(p)}}else{if(i.search(/\(\s*\)$/m)>-1){f=""}else{return i}}}f=W(f);f=D(f,"*_");var s='<a href="'+f+'"';if(g!=""){g=g.replace(/"/g,"&quot;");g=D(g,"*_");s+=' title="'+g+'"'}s+=">"+u+"</a>";return s}function g(e){e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,s);e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,s);return e}function s(e,r,n,t,a,c,o,l){var i=r;var u=n;var p=t.toLowerCase();var f=a;var g=l;if(!g)g="";if(f==""){if(p==""){p=u.toLowerCase().replace(/ ?\n/g," ")}f="#"+p;if(v.get(p)!=undefined){f=v.get(p);if(h.get(p)!=undefined){g=h.get(p)}}else{return i}}u=D(u.replace(/"/g,"&quot;"),"*_[]()");f=D(f,"*_");var s='<img src="'+f+'" alt="'+u+'"';g=g.replace(/"/g,"&quot;");g=D(g,"*_");s+=' title="'+g+'"';s+=" />";return s}function d(e){e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,r){return"<h1>"+p(r)+"</h1>\n\n"});e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,r){return"<h2>"+p(r)+"</h2>\n\n"});e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,r,n){var t=r.length;return"<h"+t+">"+p(n)+"</h"+t+">\n\n"});return e}function m(e){e+="~0";var r=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;if(a){e=e.replace(r,function(e,r,n){var t=r;var a=n.search(/[*+-]/g)>-1?"ul":"ol";var c=w(t,a);c=c.replace(/\s+$/,"");c="<"+a+">"+c+"</"+a+">\n";return c})}else{r=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g;e=e.replace(r,function(e,r,n,t){var a=r;var c=n;var o=t.search(/[*+-]/g)>-1?"ul":"ol";var l=w(c,o);l=a+"<"+o+">\n"+l+"</"+o+">\n";return l})}e=e.replace(/~0/,"");return e}var $={ol:"\\d+[.]",ul:"[*+-]"};function w(e,r){a++;e=e.replace(/\n{2,}$/,"\n");e+="~0";var n=$[r];var t=new RegExp("(^[ \\t]*)("+n+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+n+")[ \\t]+))","gm");var l=false;e=e.replace(t,function(e,r,n,t){var a=t;var c=/\n\n$/.test(a);var o=c||a.search(/\n{2,}/)>-1;if(o||l){a=i(L(a),true)}else{a=m(L(a));a=a.replace(/\n$/,"");a=p(a)}l=c;return"<li>"+a+"</li>\n"});e=e.replace(/~0/g,"");a--;return e}function _(e){e+="~0";e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,r,n){var t=r;var a=n;t=S(L(t));t=A(t);t=t.replace(/^\n+/g,"");t=t.replace(/\n+$/g,"");t="<pre><code>"+t+"\n</code></pre>";return"\n\n"+t+"\n\n"+a});e=e.replace(/~0/,"");return e}function k(e){e=e.replace(/(^\n+|\n+$)/g,"");return"\n\n~K"+(u.push(e)-1)+"K\n\n"}function C(e){e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,r,n,t,a){var c=t;c=c.replace(/^([ \t]*)/g,"");c=c.replace(/[ \t]*$/g,"");c=S(c);c=c.replace(/:\/\//g,"~P");return r+"<code>"+c+"</code>"});return e}function S(e){e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");e=D(e,"*_{}[]\\",false);return e}function b(e){e=e.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4");e=e.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4");return e}function H(e){e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,r){var n=r;n=n.replace(/^[ \t]*>[ \t]?/gm,"~0");n=n.replace(/~0/g,"");n=n.replace(/^[ \t]+$/gm,"");n=i(n);n=n.replace(/(^|\n)/g,"$1  ");n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,r){var n=r;n=n.replace(/^  /gm,"~0");n=n.replace(/~0/g,"");return n});return k("<blockquote>\n"+n+"\n</blockquote>")});return e}function y(e,r){e=e.replace(/^\n+/g,"");e=e.replace(/\n+$/g,"");var n=e.split(/\n{2,}/g);var t=[];var a=/~K(\d+)K/;var c=n.length;for(var o=0;o<c;o++){var l=n[o];if(a.test(l)){t.push(l)}else if(/\S/.test(l)){l=p(l);l=l.replace(/^([ \t]*)/g,"<p>");l+="</p>";t.push(l)}}if(!r){c=t.length;for(var o=0;o<c;o++){var i=true;while(i){i=false;t[o]=t[o].replace(/~K(\d+)K/g,function(e,r){i=true;return u[r]})}}}return t.join("\n\n")}function x(e){e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;");return e}function E(e){e=e.replace(/\\(\\)/g,F);e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,F);return e}function q(e){e=e.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4");var r=function(e,r){return'<a href="'+r+'">'+n.plainLinkText(r)+"</a>"};e=e.replace(/<((https?|ftp):[^'">\s]+)>/gi,r);return e}function K(e){e=e.replace(/~E(\d+)E/g,function(e,r){var n=parseInt(r);return String.fromCharCode(n)});return e}function L(e){e=e.replace(/^(\t|[ ]{1,4})/gm,"~0");e=e.replace(/~0/g,"");return e}function A(e){if(!/\t/.test(e))return e;var n=["    ","   ","  "," "],t=0,a;return e.replace(/[\n\t]/g,function(e,r){if(e==="\n"){t=r+1;return e}a=(r-t)%4;t=r+1;return n[a]})}var e=/(?:["'*()[\]:]|~D)/g;function W(n){if(!n)return"";var t=n.length;return n.replace(e,function(e,r){if(e=="~D")return"%24";if(e==":"){if(r==t-1||/[0-9\/]/.test(n.charAt(r+1)))return":"}return"%"+e.charCodeAt(0).toString(16)})}function D(e,r,n){var t="(["+r.replace(/([\[\]\\])/g,"\\$1")+"])";if(n){t="\\\\"+t}var a=new RegExp(t,"g");e=e.replace(a,F);return e}function F(e,r){var n=r.charCodeAt(0);return"~E"+n+"E"}function M(e,t={}){var r=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,n=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm;function f(e){if(/^:[ \t]*--*$/.test(e)){return' style="text-align:left;"'}else if(/^--*[ \t]*:[ \t]*$/.test(e)){return' style="text-align:right;"'}else if(/^:[ \t]*--*[ \t]*:$/.test(e)){return' style="text-align:center;"'}else{return""}}function g(e,r){var n="";e=e.trim();if(t.tablesHeaderId||t.tableHeaderId){n=' id="'+e.replace(/ /g,"_").toLowerCase()+'"'}e=p(e);return"<th"+n+r+">"+e+"</th>\n"}function s(e,r){var n=p(e);return"<td"+r+">"+n+"</td>\n"}function v(e,r){var n="<table>\n<thead>\n<tr>\n",t=e.length;for(var a=0;a<t;++a){n+=e[a]}n+="</tr>\n</thead>\n<tbody>\n";for(a=0;a<r.length;++a){n+="<tr>\n";for(var c=0;c<t;++c){n+=r[a][c]}n+="</tr>\n"}n+="</tbody>\n</table>\n";return n}function a(e){var r,n=e.split("\n");for(r=0;r<n.length;++r){if(/^ {0,3}\|/.test(n[r])){n[r]=n[r].replace(/^ {0,3}\|/,"")}if(/\|[ \t]*$/.test(n[r])){n[r]=n[r].replace(/\|[ \t]*$/,"")}n[r]=C(n[r])}var t=n[0].split("|").map(function(e){return e.trim()}),a=n[1].split("|").map(function(e){return e.trim()}),c=[],o=[],l=[],i=[];n.shift();n.shift();for(r=0;r<n.length;++r){if(n[r].trim()===""){continue}c.push(n[r].split("|").map(function(e){return e.trim()}))}if(t.length<a.length){return e}for(r=0;r<a.length;++r){l.push(f(a[r]))}for(r=0;r<t.length;++r){if(typeof l[r]==="undefined"){l[r]=""}o.push(g(t[r],l[r]))}for(r=0;r<c.length;++r){var u=[];for(var p=0;p<o.length;++p){u.push(s(c[r][p],l[p]))}i.push(u)}return v(o,i)}e=e.replace(/\\(\|)/g,F);e=e.replace(r,a);e=e.replace(n,a);return e}function N(e){function r(e,r){return"<del>"+r+"</del>"}e=e.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,r);return e}function T(e){const r=/```(\w*)\n([\s\S]*?)\n```/g;const n=e.match(r);const t=n?n.map(e=>({language:e.replace(/```(\w*)\n[\s\S]*/,"$1").trim(),code:e.replace(/```(\w*)\n|\n```/g,"").trim()})):[];let a=e;for(let e=0;e<t.length;e++){const{language:c,code:o}=t[e];const l=`<pre><code class="${c}">${o}</code></pre>`;a=a.replace(n[e],l)}return a}};module.exports=Markdown;