"use strict";var Markdown={};function identity(e){return e}function returnFalse(e){return false}function HookCollection(){}HookCollection.prototype={chain:function(e,n){var t=this[e];if(!t)throw new Error("unknown hook "+e);if(t===identity)this[e]=n;else this[e]=function(e){var r=Array.prototype.slice.call(arguments,0);r[0]=t.apply(null,r);return n.apply(null,r)}},set:function(e,r){if(!this[e])throw new Error("unknown hook "+e);this[e]=r},addNoop:function(e){this[e]=identity},addFalse:function(e){this[e]=returnFalse}};Markdown.HookCollection=HookCollection;function SaveHash(){}SaveHash.prototype={set:function(e,r){this["s_"+e]=r},get:function(e){return this["s_"+e]}};Markdown.Converter=function(r){var a=this.hooks=new HookCollection;a.addNoop("plainLinkText");a.addNoop("preConversion");a.addNoop("postNormalization");a.addNoop("preBlockGamut");a.addNoop("postBlockGamut");a.addNoop("preSpanGamut");a.addNoop("postSpanGamut");a.addNoop("postCodeGamut");a.addNoop("postConversion");var v;var d;var p;var o;r=r||{};this.makeHtml=function(e){if(v)throw new Error("Recursive call to converter.makeHtml");v=new SaveHash;d=new SaveHash;p=[];o=0;e=a.preConversion(e);e=P(e);e=D(e);e=e.replace(/~/g,"~T");e=e.replace(/\$/g,"~D");e=e.replace(/\r\n/g,"\n");e=e.replace(/\r/g,"\n");e="\n\n"+e+"\n\n";e=L(e);e=T(e,r);e=e.replace(/^[ \t]+$/gm,"");e=a.postNormalization(e);e=i(e);e=n(e);e=u(e);e=O(e);e=e.replace(/~D/g,"$$");e=e.replace(/~T/g,"~");e=a.postConversion(e);p=d=v=null;return e};function n(e){e=e.replace(/^[ ]{0,3}\[([^\[\]]+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(\n+)/gm,function(e,r,n,t,a,o,i){r=r.toLowerCase();v.set(r,G(n));if(a){return t+i}else if(o){d.set(r,o.replace(/"/g,"&quot;"))}return""});return e}function i(e){e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,l);e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,l);e=e.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,l);e=e.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,l);e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,l);return e}function t(e){e=e.replace(/(^\n+|\n+$)/g,"");return"\n\n~K"+(p.push(e)-1)+"K\n\n"}function l(e,r){return t(r)}var c=function(e){return u(e)};function u(e,r,n){e=a.preBlockGamut(e,c);e=k(e);var t="<hr />\n";e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,t);e=e.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,t);e=e.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,t);e=S(e);e=b(e);e=E(e);e=a.postBlockGamut(e,c);e=i(e);e=N(e,r,n);return e}function h(e){e=a.preSpanGamut(e);e=x(e);e=f(e);e=I(e);e=m(e);e=s(e);e=M(e);e=e.replace(/~P/g,"://");e=G(e);e=H(e);e=e.replace(/  +\n/g," <br />\n");e=a.postSpanGamut(e);return e}function f(e){var r=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;e=e.replace(r,function(e){var r=e.replace(/(.)<\/?code>(?=.)/g,"$1`");r=K(r,e.charAt(1)=="!"?"\\`*_/":"\\`*_");return r});return e}function s(e){if(e.indexOf("[")===-1)return e;e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,g);e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,g);e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,g);return e}function g(e,r,n,t,a,o,i,l){if(l==undefined)l="";var c=r;var u=n.replace(/:\/\//g,"~P");var p=t.toLowerCase();var f=a;var s=l;if(f==""){if(p==""){p=u.toLowerCase().replace(/ ?\n/g," ")}f="#"+p;if(v.get(p)!=undefined){f=v.get(p);if(d.get(p)!=undefined){s=d.get(p)}}else{if(c.search(/\(\s*\)$/m)>-1){f=""}else{return c}}}f=q(f);var g='<a href="'+f+'"';if(s!=""){s=$(s);s=K(s,"*_");g+=' title="'+s+'"'}g+=">"+u+"</a>";return g}function m(e){if(e.indexOf("![")===-1)return e;e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,w);e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,w);return e}function $(e){return e.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function w(e,r,n,t,a,o,i,l){var c=r;var u=n;var p=t.toLowerCase();var f=a;var s=l;if(!s)s="";if(f==""){if(p==""){p=u.toLowerCase().replace(/ ?\n/g," ")}f="#"+p;if(v.get(p)!=undefined){f=v.get(p);if(d.get(p)!=undefined){s=d.get(p)}}else{return c}}u=K($(u),"*_[]()");f=K(f,"*_");var g='<img src="'+f+'" alt="'+u+'"';s=$(s);s=K(s,"*_");g+=' title="'+s+'"';g+=" />";return g}function k(e){e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,r){return"<h1>"+h(r)+"</h1>\n\n"});e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,r){return"<h2>"+h(r)+"</h2>\n\n"});e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,r,n){var t=r.length;return"<h"+t+">"+h(n)+"</h"+t+">\n\n"});return e}function S(e){e+="~0";var r=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;if(o){e=e.replace(r,function(e,r,n){var t=r;var a=n.search(/[*+-]/g)>-1?"ul":"ol";var o;if(a==="ol")o=parseInt(n,10);var i=C(t,a);i=i.replace(/\s+$/,"");var l="<"+a;if(o&&o!==1)l+=' start="'+o+'"';i=l+">"+i+"</"+a+">\n";return i})}else{r=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g;e=e.replace(r,function(e,r,n,t){var a=r;var o=n;var i=t.search(/[*+-]/g)>-1?"ul":"ol";var l;if(i==="ol")l=parseInt(t,10);var c=C(o,i);var u="<"+i;if(l&&l!==1)u+=' start="'+l+'"';c=a+u+">\n"+c+"</"+i+">\n";return c})}e=e.replace(/~0/,"");return e}var _={ol:"\\d+[.]",ul:"[*+-]"};function C(e,r){o++;e=e.replace(/\n{2,}$/,"\n");e+="~0";var n=_[r];var t=new RegExp("(^[ \\t]*)("+n+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+n+")[ \\t]+))","gm");var c=false;e=e.replace(t,function(e,r,n,t){var a=t;var o=/\n\n$/.test(a);var i=o||a.search(/\n{2,}/)>-1;var l=i||c;a=u(A(a),true,!l);c=o;return"<li>"+a+"</li>\n"});e=e.replace(/~0/g,"");o--;return e}function b(e){e+="~0";e=e.replace(/(?:\n\n|^\n?)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,r,n){var t=r;var a=n;t=y(A(t));t=L(t);t=t.replace(/^\n+/g,"");t=t.replace(/\n+$/g,"");t="<pre><code>"+t+"\n</code></pre>";return"\n\n"+t+"\n\n"+a});e=e.replace(/~0/,"");return e}function x(e){e=e.replace(/(^|[^\\`])(`+)(?!`)([^\r]*?[^`])\2(?!`)/gm,function(e,r,n,t,a){var o=t;o=o.replace(/^([ \t]*)/g,"");o=o.replace(/[ \t]*$/g,"");o=y(o);o=o.replace(/:\/\//g,"~P");return r+"<code>"+o+"</code>"});return e}function y(e){e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");e=K(e,"*_{}[]\\",false);return e}function H(e){if(e.indexOf("*")===-1&&e.indexOf("_")===-1)return e;e=e.replace(/(^|[\W_])(?:(?!\1)|(?=^))(\*|_)\2(?=\S)([^\r]*?\S)\2\2(?!\2)(?=[\W_]|$)/g,"$1<strong>$3</strong>");e=e.replace(/(^|[\W_])(?:(?!\1)|(?=^))(\*|_)(?=\S)((?:(?!\2)[^\r])*?\S)\2(?!\2)(?=[\W_]|$)/g,"$1<em>$3</em>");return e}function E(e){e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,r){var n=r;n=n.replace(/^[ \t]*>[ \t]?/gm,"~0");n=n.replace(/~0/g,"");n=n.replace(/^[ \t]+$/gm,"");n=u(n);n=n.replace(/(^|\n)/g,"$1  ");n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,r){var n=r;n=n.replace(/^  /gm,"~0");n=n.replace(/~0/g,"");return n});return t("<blockquote>\n"+n+"\n</blockquote>")});return e}function N(e,r,n){e=e.replace(/^\n+/g,"");e=e.replace(/\n+$/g,"");var t=e.split(/\n{2,}/g);var a=[];var o=/~K(\d+)K/;var i=t.length;for(var l=0;l<i;l++){var c=t[l];if(o.test(c)){a.push(c)}else if(/\S/.test(c)){c=h(c);c=c.replace(/^([ \t]*)/g,n?"":"<p>");if(!n)c+="</p>";a.push(c)}}if(!r){i=a.length;for(var l=0;l<i;l++){var u=true;while(u){u=false;a[l]=a[l].replace(/~K(\d+)K/g,function(e,r){u=true;return p[r]})}}}return a.join("\n\n")}function G(e){e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");e=e.replace(/<(?![a-z\/?!]|~D)/gi,"&lt;");return e}function I(e){e=e.replace(/\\(\\)/g,R);e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,R);return e}var W="[-A-Z0-9+&@#/%?=~_|[\\]()!:,.;]",e="[-A-Z0-9+&@#/%=~_|[\\])]",z=new RegExp('(="|<)?\\b(https?|ftp)(://'+W+"*"+e+")(?=$|\\W)","gi"),B=new RegExp(e,"i");function F(e,r,n,t){if(r)return e;if(t.charAt(t.length-1)!==")")return"<"+n+t+">";var a=t.match(/[()]/g);var o=0;for(var i=0;i<a.length;i++){if(a[i]==="("){if(o<=0)o=1;else o++}else{o--}}var l="";if(o<0){var c=new RegExp("\\){1,"+-o+"}$");t=t.replace(c,function(e){l=e;return""})}if(l){var u=t.charAt(t.length-1);if(!B.test(u)){l=u+l;t=t.substr(0,t.length-1)}}return"<"+n+t+">"+l}function M(e){e=e.replace(z,F);var r=function(e,r){var n=q(r);return'<a href="'+n+'">'+a.plainLinkText(r)+"</a>"};e=e.replace(/<((https?|ftp):[^'">\s]+)>/gi,r);return e}function O(e){e=e.replace(/~E(\d+)E/g,function(e,r){var n=parseInt(r);return String.fromCharCode(n)});return e}function A(e){e=e.replace(/^(\t|[ ]{1,4})/gm,"~0");e=e.replace(/~0/g,"");return e}function L(e){if(!/\t/.test(e))return e;var n=["    ","   ","  "," "],t=0,a;return e.replace(/[\n\t]/g,function(e,r){if(e==="\n"){t=r+1;return e}a=(r-t)%4;t=r+1;return n[a]})}function q(e){e=$(e);e=K(e,"*_:()[]");return e}function K(e,r,n){var t="(["+r.replace(/([\[\]\\])/g,"\\$1")+"])";if(n){t="\\\\"+t}var a=new RegExp(t,"g");e=e.replace(a,R);return e}function R(e,r){var n=r.charCodeAt(0);return"~E"+n+"E"}function T(e,t={}){var r=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,n=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm;function f(e){if(/^:[ \t]*--*$/.test(e)){return' style="text-align:left;"'}else if(/^--*[ \t]*:[ \t]*$/.test(e)){return' style="text-align:right;"'}else if(/^:[ \t]*--*[ \t]*:$/.test(e)){return' style="text-align:center;"'}else{return""}}function s(e,r){var n="";e=e.trim();if(t.tablesHeaderId||t.tableHeaderId){n=' id="'+e.replace(/ /g,"_").toLowerCase()+'"'}e=h(e);return"<th"+n+r+">"+e+"</th>\n"}function g(e,r){var n=h(e);return"<td"+r+">"+n+"</td>\n"}function v(e,r){var n="<table>\n<thead>\n<tr>\n",t=e.length;for(var a=0;a<t;++a){n+=e[a]}n+="</tr>\n</thead>\n<tbody>\n";for(a=0;a<r.length;++a){n+="<tr>\n";for(var o=0;o<t;++o){n+=r[a][o]}n+="</tr>\n"}n+="</tbody>\n</table>\n";return n}function a(e){var r,n=e.split("\n");for(r=0;r<n.length;++r){if(/^ {0,3}\|/.test(n[r])){n[r]=n[r].replace(/^ {0,3}\|/,"")}if(/\|[ \t]*$/.test(n[r])){n[r]=n[r].replace(/\|[ \t]*$/,"")}n[r]=x(n[r])}var t=n[0].split("|").map(function(e){return e.trim()}),a=n[1].split("|").map(function(e){return e.trim()}),o=[],i=[],l=[],c=[];n.shift();n.shift();for(r=0;r<n.length;++r){if(n[r].trim()===""){continue}o.push(n[r].split("|").map(function(e){return e.trim()}))}if(t.length<a.length){return e}for(r=0;r<a.length;++r){l.push(f(a[r]))}for(r=0;r<t.length;++r){if(typeof l[r]==="undefined"){l[r]=""}i.push(s(t[r],l[r]))}for(r=0;r<o.length;++r){var u=[];for(var p=0;p<i.length;++p){u.push(g(o[r][p],l[p]))}c.push(u)}return v(i,c)}e=e.replace(/\\(\|)/g,R);e=e.replace(r,a);e=e.replace(n,a);return e}function D(e){function r(e,r){return"<del>"+r+"</del>"}e=e.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,r);return e}function P(e){e=e.replace(/```(\w+)?([\s\S]*?)```|\`\`\`([\s\S]*?)\`\`\`/g,function(e,r,n){if(!/[\n\r]/.test(n)){return`\`${n}\``}let t=a.postCodeGamut(n,r);return`<div class="code"><header></header><pre><code class="language-${r}">${t}</code></pre></div>`});return e}};module.exports=Markdown;